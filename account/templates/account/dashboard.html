{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="mb-4 d-sm-flex align-items-center justify-content-between">
        <h1 class="mb-0 text-gray-800 h3">Dashboard</h1>
    </div>

    <!-- Content Row -->
    <div class="row">
        <div class="mb-4 col-xl-4 col-md-6">
            <div class="py-2 shadow card border-left-primary h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="mr-2 col">
                            <div class="mb-1 text-xs font-weight-bold text-primary text-uppercase">Jumlah User
                            </div>
                            <div class="mb-0 text-gray-800 h5 font-weight-bold">
                                {{count_account}}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="text-gray-300 fas fa-users fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a href="{% url 'document:doc-list-skai' %}"  class="mb-4 col-xl-4 col-md-6">
            <div class="py-2 shadow card border-left-primary h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="mr-2 col">
                            <div class="mb-1 text-xs font-weight-bold text-primary text-uppercase">Jumlah SKAI Upload 
                            </div>
                            <div class="mb-0 text-gray-800 h5 font-weight-bold">
                                {{count_skai}}
                            </div>
                        </div>
                        <div class="col-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-file-text-fill" viewBox="0 0 16 16">
                                <path d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM5 4h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1zm0 2h3a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </a>
        <a href="#"  class="mb-4 col-xl-4 col-md-6">
            <div class="py-2 shadow card border-left-primary h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="mr-2 col">
                            <div class="mb-1 text-xs font-weight-bold text-primary text-uppercase">Jumlah Laporan 
                            </div>
                            <div class="mb-0 text-gray-800 h5 font-weight-bold" id="text-ws">
                                300
                            </div>
                        </div>
                        <div class="col-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-file-text-fill" viewBox="0 0 16 16">
                                <path d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM5 4h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1zm0 2h3a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <!--Link-->

    <div class="row">
        <div class="mt-4 col-12 col-md-4">
            <div class="p-4 shadow card">
                <div class="m-4 card-body">
                    Teks
                </div>
            </div>
        </div>
        <div class="mt-4 col-12 col-md-4">
            <div class="p-4 shadow card">
                <div class="m-4 card-body">
                    Teks
                </div>
            </div>
        </div>
        <div class="mt-4 col-12 col-md-4">
            <div class="p-4 shadow card">
                <div class="m-4 card-body">
                    Teks
                </div>
            </div>
        </div>
        <div class="mt-4 col-12 col-md-4">
            <div class="p-4 shadow card">
                <div class="m-4 card-body">
                    Teks
                </div>
            </div>
        </div>
        <div class="mt-4 col-12 col-md-4">
            <div class="p-4 shadow card">
                <div class="m-4 card-body">
                    Teks
                </div>
            </div>
        </div>
        <div class="mt-4 col-12 col-md-4">
            <div class="p-4 shadow card">
                <div class="m-4 card-body">
                    Teks
                </div>
            </div>
        </div>
    </div>

    
</div>
{% endblock content %}

{% block script %}
<script>
    number_one = document.getElementById('text-ws')
    var wsStart='ws://'
    var endpoint = wsStart + window.location.host + window.location.pathname
    var notificationSocket = new WebSocket(endpoint)

    notificationSocket.onclose = function(e) {
        console.error('Notification Socket closed unexpectedly');
    };

    notificationSocket.onopen = function(e){
        console.log("Notification Socket on open: " + e)
        // if("{{request.user.is_authenticated}}"){
		// 	notificationSocket.send(JSON.stringify({
		// 		"command": "dummy_command",
		//     }));
		// }
        setupGeneralNotificationsMenu()
        getFirstGeneralNotificationsPage()
        getUnreadGeneralNotificationsCount()

        //setupChatNotificationsMenu()
        //getFirstChatNotificationsPage()
    }

    notificationSocket.onmessage = function(message){
        console.log(message)
        var data = JSON.parse(message.data);
        console.log("Got notification websocket message. " + data.general_msg_type);
        
        /*
            GENERAL NOTIFICATIONS
        */
        // new 'general' notifications data payload
        if(data.general_msg_type == 0){
            handleGeneralNotificationsData(JSON.parse(data['notifications']), data['new_page_number'])
        }

        // "General" Pagination exhausted. No more results.
        if(data.general_msg_type == 1){
            setGeneralPaginationExhausted()
        }

        // Refresh [newest_timestamp >= NOTIFICATIONS >= oldest_timestamp]
        if(data.general_msg_type == 2){
            refreshGeneralNotificationsData(JSON.parse(data['notifications']))
        }

        if(data.general_msg_type == 3){
            handleNewGeneralNotificationsData(JSON.parse(data['notifications']))
        }

        if(data.general_msg_type == 4){
            setUnreadGeneralNotificationsCount(data['count'])
        }

        if(data.general_msg_type == 5){
            updateGeneralNotificationDiv(data['notification'])
        }

        
    }

</script>
{% endblock script %}